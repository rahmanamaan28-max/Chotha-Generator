<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chotha Generator - Document Upload</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #2c3e50;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        
        .instructions {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
            border-left: 5px solid #3498db;
        }
        
        .instructions h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 1.3rem;
        }
        
        .instructions ul {
            margin-left: 25px;
            margin-bottom: 15px;
        }
        
        .instructions li {
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .app-container {
            display: flex;
            flex-wrap: wrap;
            padding: 20px;
            gap: 20px;
        }
        
        .input-section, .output-section {
            flex: 1;
            min-width: 300px;
        }
        
        h2 {
            margin-bottom: 1rem;
            color: #2c3e50;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #3498db;
            font-size: 1.5rem;
        }
        
        textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 15px;
            resize: vertical;
            font-family: 'Courier New', monospace;
        }
        
        .file-input-container {
            margin-bottom: 20px;
        }
        
        .file-input-label {
            display: block;
            padding: 15px 20px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        
        .file-input-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }
        
        input[type="file"] {
            display: none;
        }
        
        .compression-controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .size-control, .compression-level {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .size-control label, .compression-level label {
            font-size: 14px;
            min-width: 120px;
            font-weight: 600;
        }
        
        #fontSize {
            width: 150px;
        }
        
        #fontSizeValue {
            font-size: 14px;
            min-width: 40px;
            font-weight: 600;
        }
        
        #compressionLevel {
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #ddd;
            width: 150px;
        }
        
        button {
            background: #2c3e50;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 12px;
            font-weight: 600;
        }
        
        button:hover {
            background: #1a2530;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }
        
        .output-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 14px;
            color: #7f8c8d;
            font-weight: 600;
        }
        
        .chotha-container {
            width: 100%;
            min-height: 400px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .chotha-box {
            border: 1px solid #2c3e50;
            padding: 10px;
            font-size: 8px;
            line-height: 1;
            overflow: hidden;
            background: white;
            page-break-inside: avoid;
            break-inside: avoid;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .chotha-heading {
            font-weight: bold;
            text-decoration: underline;
            display: block;
            margin-bottom: 5px;
            font-size: 9px;
        }
        
        .chotha-heading::after {
            content: ":";
        }
        
        .chotha-content {
            display: block;
        }
        
        .chotha-keyword {
            font-weight: bold;
        }
        
        .chotha-arrow {
            margin: 0 2px;
        }
        
        .output-controls {
            display: flex;
            gap: 10px;
        }
        
        .status-message {
            padding: 12px;
            margin: 15px 0;
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
        }
        
        .status-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-processing {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .output-controls {
                flex-direction: column;
            }
            
            .chotha-container {
                grid-template-columns: 1fr;
            }
        }
        
        @media print {
            body, .container {
                background: white;
                box-shadow: none;
                padding: 0;
                margin: 0;
            }
            
            .input-section, .output-controls, header, .instructions {
                display: none;
            }
            
            .output-section {
                width: 100%;
            }
            
            .chotha-container {
                min-height: auto;
                border: none;
                background: white;
                padding: 0;
            }
            
            .chotha-box {
                width: 3in;
                height: 3in;
                border: 1px solid #000;
                page-break-inside: avoid;
            }
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .upload-info {
            margin-top: 10px;
            font-size: 14px;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Chotha Generator</h1>
            <p>Create ultra-compact revision sheets for exam preparation</p>
        </header>
        
        <div class="instructions">
            <h3>Chotha Format Rules:</h3>
            <ul>
                <li>Complete coverage - no points skipped</li>
                <li>Ultra-compact writing with short forms & symbols</li>
                <li>Headings underlined with colon</li>
                <li>No bullets, no extra spaces, line spacing = 1</li>
                <li>Small font size (like handwritten size 3)</li>
                <li>Grid format with palm-sized boxes</li>
            </ul>
            <p class="upload-info">Note: For document uploads, only text files (.txt) are supported in this browser version. For PDF, Word, and Excel files, you'll need to set up the server version.</p>
        </div>
        
        <div class="app-container">
            <div class="input-section">
                <h2>Input Content</h2>
                
                <div class="file-input-container">
                    <label for="fileInput" class="file-input-label">Upload Text File</label>
                    <input type="file" id="fileInput" accept=".txt">
                    <div id="fileStatus" class="status-message status-info">Select a text file or paste content below</div>
                </div>
                
                <textarea id="rawNotes" placeholder="Paste your full notes here... Each new topic should be on a new line or separated by a semicolon (;)"></textarea>
                
                <div class="compression-controls">
                    <div class="size-control">
                        <label for="fontSize">Font Size:</label>
                        <input type="range" id="fontSize" min="6" max="10" value="8">
                        <span id="fontSizeValue">8px</span>
                    </div>
                    
                    <div class="compression-level">
                        <label for="compressionLevel">Compression Level:</label>
                        <select id="compressionLevel">
                            <option value="normal">Normal</option>
                            <option value="high">High</option>
                            <option value="extreme">Extreme</option>
                        </select>
                    </div>
                </div>
                
                <button id="generateBtn">Generate Chotha</button>
                <button id="clearBtn">Clear All</button>
            </div>
            
            <div class="output-section">
                <h2>Chotha Output</h2>
                <div class="output-info">
                    <span id="boxCount">0 boxes</span>
                    <span id="contentStats">0 characters</span>
                </div>
                
                <div id="chothaContainer" class="chotha-container">
                    <div class="chotha-box">
                        <span class="chotha-heading">Sample Topic</span>
                        <span>Your generated content will appear here in ultra-compact format</span>
                    </div>
                </div>
                
                <div class="output-controls">
                    <button id="downloadBtn">Download Chotha</button>
                    <button id="printBtn">Print Chotha</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM elements
        const fileInput = document.getElementById('fileInput');
        const rawNotes = document.getElementById('rawNotes');
        const generateBtn = document.getElementById('generateBtn');
        const clearBtn = document.getElementById('clearBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const printBtn = document.getElementById('printBtn');
        const chothaContainer = document.getElementById('chothaContainer');
        const fontSizeSlider = document.getElementById('fontSize');
        const fontSizeValue = document.getElementById('fontSizeValue');
        const compressionLevel = document.getElementById('compressionLevel');
        const fileStatus = document.getElementById('fileStatus');
        const boxCount = document.getElementById('boxCount');
        const contentStats = document.getElementById('contentStats');

        // Initialize with sample text
        rawNotes.value = "PERCEPTION:\nProcess of interpreting sensations into meaningful patterns. It involves three steps: selection, organization, interpretation. Selection is focusing on certain stimuli. Organization uses Gestalt principles: similarity, proximity, continuity, closure. Interpretation assigns meaning based on past experience.\n\nGESTALT PRINCIPLES:\nLaws of organization. Figure-ground: we separate objects from background. Similarity: similar items are grouped. Proximity: nearby items are grouped. Continuity: we see continuous patterns. Closure: we fill in gaps to see complete objects.";

        // Update font size value display
        fontSizeSlider.addEventListener('input', function() {
            fontSizeValue.textContent = `${this.value}px`;
            adjustFontSize(this.value);
        });

        // Load document from file input
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            // Show loading state
            fileStatus.textContent = `Processing ${file.name}...`;
            fileStatus.className = 'status-message status-info';
            
            // Handle text files
            if (file.type === 'text/plain' || file.name.endsWith('.txt')) {
                handleTextFile(file);
            } else {
                fileStatus.textContent = 'Please upload a text file (.txt)';
                fileStatus.className = 'status-message status-error';
            }
        });

        // Handle text files
        function handleTextFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                rawNotes.value = e.target.result;
                fileStatus.textContent = `${file.name} loaded successfully`;
                fileStatus.className = 'status-message status-success';
            };
            reader.onerror = function() {
                fileStatus.textContent = 'Error reading file';
                fileStatus.className = 'status-message status-error';
            };
            reader.readAsText(file);
        }

        // Generate Chotha
        generateBtn.addEventListener('click', function() {
            const text = rawNotes.value.trim();
            if (!text) {
                alert('Please enter some notes first!');
                return;
            }

            chothaContainer.innerHTML = '';
            
            // Parse input - split by lines that look like headings
            const lines = text.split('\n');
            let currentTopic = '';
            let currentContent = '';
            const topics = [];
            
            for (const line of lines) {
                // Check if this line is a heading (all caps, ends with colon, or significantly different from previous lines)
                const isHeading = line.match(/^[A-Z][A-Z\s]+:$/) || 
                                 (line.length > 0 && line.length < 30 && line.toUpperCase() === line) ||
                                 line.endsWith(':');
                
                if (isHeading) {
                    // Save previous topic if exists
                    if (currentTopic) {
                        topics.push({ topic: currentTopic, content: currentContent });
                    }
                    
                    // Start new topic
                    currentTopic = line.replace(':', '').trim();
                    currentContent = '';
                } else {
                    // Add to current content
                    currentContent += line + ' ';
                }
            }
            
            // Add the last topic
            if (currentTopic) {
                topics.push({ topic: currentTopic, content: currentContent });
            }
            
            // If no topics were detected, create one with all content
            if (topics.length === 0) {
                topics.push({ topic: 'Notes', content: text });
            }
            
            let totalChars = 0;
            
            // Process each topic
            topics.forEach(item => {
                const box = document.createElement('div');
                box.classList.add('chotha-box');
                
                // Apply current font size
                const fontSize = fontSizeSlider.value;
                box.style.fontSize = `${fontSize}px`;
                
                // Create heading
                const headingSpan = document.createElement('span');
                headingSpan.classList.add('chotha-heading');
                headingSpan.textContent = item.topic;
                box.appendChild(headingSpan);
                
                // Process content based on compression level
                const processedContent = processContent(item.content, compressionLevel.value);
                totalChars += processedContent.length;
                
                const contentSpan = document.createElement('span');
                contentSpan.classList.add('chotha-content');
                contentSpan.innerHTML = processedContent;
                box.appendChild(contentSpan);
                
                // Add to container
                chothaContainer.appendChild(box);
            });
            
            // Update stats
            boxCount.textContent = `${topics.length} boxes`;
            contentStats.textContent = `${totalChars} characters`;
        });

        // Process content to make it ultra-compact
        function processContent(text, level) {
            // Remove extra spaces and line breaks
            let processedText = text.replace(/\s+/g, ' ').trim();
            
            // Apply short forms and replacements
            const replacements = {
                'important': 'Imp.',
                'definition': 'Def.',
                'function': 'Func.',
                'example': 'Eg.',
                'increase': '↑',
                'decrease': '↓',
                ' leads to ': '→',
                ' results in ': '→',
                ' therefore ': '∴',
                ' because ': '∵',
                ' and ': ' & ',
                ' with ': ' w/ ',
                ' without ': ' w/o ',
                ' approximately ': '≈',
                ' equals ': '=',
                ' not equal ': '≠',
                ' greater than ': '>',
                ' less than ': '<',
                ' plus ': '+',
                ' minus ': '-',
                ' divided by ': '÷',
                ' multiplied by ': '×',
            };
            
     // Apply replacements
            for (const [key, value] of Object.entries(replacements)) {
                const regex = new RegExp(key, 'gi');
                processedText = processedText.replace(regex, value);
            }
            
            // Apply compression based on level
            if (level === 'high' || level === 'extreme') {
                // Remove articles and some pronouns
                processedText = processedText.replace(/\b(the|a|an|is|are|was|were|be|being|been)\b/gi, '');
                
                // Remove unnecessary words
                processedText = processedText.replace(/\b(this|that|these|those|which|who|whom|whose)\b/gi, '');
            }
            
            if (level === 'extreme') {
                // Remove vowels from longer words (but keep first letter)
                processedText = processedText.replace(/\b([bcdfghjklmnpqrstvwxyzBCDFGHJKLMNPQRSTVWXYZ]{3,})[aeiouAEIOU]+([bcdfghjklmnpqrstvwxyzBCDFGHJKLMNPQRSTVWXYZ]*)\b/g, '$1$2');
                
                // Shorten common suffixes
                processedText = processedText.replace(/(ing|ed|tion|sion|ment|ity|able|ible|al|ive|ous|ful|less|ness|ship|hood|dom|ism|ist|ance|ence|ery|ory)\b/gi, '');
            }
            
            // Add line breaks for natural breaks
            processedText = processedText.replace(/\. /g, '.<br>');
            processedText = processedText.replace(/! /g, '!<br>');
            processedText = processedText.replace(/\? /g, '?<br>');
            processedText = processedText.replace(/; /g, ';<br>');
            
            // Highlight keywords
            processedText = processedText.replace(/\b([A-Z][a-z]+|[0-9]+%?|↑|↓|→|∴|∵|≈|=|≠|>|<|\+|-|÷|×)\b/g, '<span class="chotha-keyword">$1</span>');
            
            return processedText;
        }

        // Adjust font size
        function adjustFontSize(size) {
            const boxes = document.querySelectorAll('.chotha-box');
            boxes.forEach(box => {
                box.style.fontSize = `${size}px`;
            });
        }

        // Clear all
        clearBtn.addEventListener('click', function() {
            rawNotes.value = '';
            chothaContainer.innerHTML = '';
            fileInput.value = '';
            fileStatus.textContent = 'Select a file to begin';
            fileStatus.className = 'status-message status-info';
            boxCount.textContent = '0 boxes';
            contentStats.textContent = '0 characters';
            
            // Add a default empty box
            const box = document.createElement('div');
            box.classList.add('chotha-box');
            box.innerHTML = '<span class="chotha-heading">New Topic</span><span>Content will appear here</span>';
            chothaContainer.appendChild(box);
        });

        // Download Chotha
        downloadBtn.addEventListener('click', function() {
            // Create a printable version
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Chotha - Printable Version</title>
                    <style>
                        body { font-family: Courier New, monospace; padding: 10px; font-size: 8px; line-height: 1; }
                        .chotha-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; }
                        .chotha-box { width: 3in; height: 3in; border: 1px solid #000; padding: 5px; page-break-inside: avoid; }
                        .chotha-heading { font-weight: bold; text-decoration: underline; display: block; margin-bottom: 3px; }
                        .chotha-heading::after { content: ":"; }
                        .chotha-keyword { font-weight: bold; }
                        @media print { body { margin: 0; padding: 0; } }
                    </style>
                </head>
                <body>
                    <div class="chotha-container">
                        ${chothaContainer.innerHTML}
                    </div>
                    <script>
                        window.onload = function() { window.print(); }
                    <\/script>
                </body>
                </html>
            `);
            printWindow.document.close();
        });

        // Print Chotha
        printBtn.addEventListener('click', function() {
            window.print();
        });
    </script>
</body>
</html>
